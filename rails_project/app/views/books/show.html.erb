<%= flash_messages %>

<div class="row page-book">

  <% if @book.avatar.exists? %>
    <div class="col-md-2 col-md-offset-3 book-catalogue">
      <%= image_tag @book.avatar.url(:medium) %>
    </div>
  <% end %>

  <div class="col-md-4">


      <h1><%= @book.title %></h1>


    <p>
      <%= raw @book.text %>
    </p>

    <p>
      <strong>Auteur :</strong>
      <%= @book.author %>
    </p>

    <p>
      <strong>Date de publication:</strong>
      <%= afficher_date(@book.date) %>
    </p>

    <p>
      <strong>Nombre de livres en stock:</strong>
      <%= stock_book(@book) %><% if can? :manage, :all and @book.stock.present? %> <%= total_et_pretes(@book) %> <% end %>
    </p>

    <% if current_user  %>
        <% reservation_livre = Reservation.where(["user_id = ?", current_user.id]).where(["book_id = ?", @book.id]).last %>
        <% if !defined?(reservation_livre.id) %>
            <%= en_stock(@book) %>
        <% end %>
        <% if defined?(reservation_livre.id)  %>
            <% if reservation_livre.rendu %>
                <%= en_stock(@book) %>
            <% else %>
                <%= link_to 'Rendre le livre', book_reservation_path(@book, reservation_livre), method: :livre_rendu, class: 'btn btn-default' %>
                <%= link_to 'Voir ma réservation en cours', book_reservation_path(@book, reservation_livre), class: 'btn btn-default'%>
            <% end %>
        <% end %>


    <% else %>
        <p>Vous devez être connecté si vous souhaitez réserver un livre</p> <br>
    <% end %>

    <!-- if admin -->
    <%= link_to 'Retour au catalogue', books_path, class: 'btn btn-default' %>

  </div>

</div>

<hr>

<div class="list-same-author">

</div>


